<%- partial('_partial/header') %>

<div class="vscode-container">
  <div class="sidebar-explorer">
    <div class="explorer-header">
      <span class="explorer-title">
        <i class="fas fa-folder-open"></i> EXPLORER
      </span>
    </div>
    
    <div class="explorer-section">
      <div class="section-header">
        <i class="fas fa-chevron-down"></i>
        <span>BLOG CONTENTS</span>
      </div>
      
      <div class="section-content">
        <%_ site.categories.each(function(category){ _%>
          <div class="folder">
            <i class="fas fa-folder"></i>
            <a href="<%- url_for(category.path) %>" class="category-link">
              <span><%- category.name %></span>
              <span class="count">(<%- category.length %>)</span>
            </a>
          </div>
        <%_ }); _%>
      </div>
    </div>
    
    <div class="explorer-section">
      <div class="section-header">
        <i class="fas fa-chevron-down"></i>
        <span>RECENT POSTS</span>
      </div>
      
      <div class="section-content">
        <%_ site.posts.sort('date', -1).limit(5).each(function(post){ _%>
          <div class="file">
            <i class="fas fa-file-code"></i>
            <a href="<%- url_for(post.path) %>"><%- post.title %></a>
          </div>
        <%_ }); _%>
      </div>
    </div>

    <div class="explorer-section">
      <div class="section-header">
        <i class="fas fa-chevron-down"></i>
        <span>TAGS</span>
      </div>
      
      <div class="section-content">
        <%
        // 获取所有标签并按拼音排序（中英混合）
        const allIndexTags = [];
        site.tags.each(function(tag) {
          const firstLetter = getPinyinFirstLetter(tag.name);
          allIndexTags.push({
            name: tag.name,
            path: tag.path,
            length: tag.length,
            firstLetter: firstLetter
          });
        });
        
        // 按拼音首字母排序，然后按完整拼音排序
        allIndexTags.sort((a, b) => {
          if (a.firstLetter === '#' && b.firstLetter !== '#') return 1;
          if (a.firstLetter !== '#' && b.firstLetter === '#') return -1;
          if (a.firstLetter !== b.firstLetter) {
            return a.firstLetter.localeCompare(b.firstLetter);
          }
          const pinyinA = getPinyinSortKey ? getPinyinSortKey(a.name) : a.name.toLowerCase();
          const pinyinB = getPinyinSortKey ? getPinyinSortKey(b.name) : b.name.toLowerCase();
          return pinyinA.localeCompare(pinyinB);
        });
        %>
        <% allIndexTags.forEach(function(tag){ %>
          <div class="tag-item">
            <i class="fas fa-tag"></i>
            <a href="<%- url_for(tag.path) %>"><%= tag.name %></a>
            <span class="count">(<%= tag.length %>)</span>
          </div>
        <% }) %>
      </div>
    </div>
  </div>

  <div class="editor-content">
    <div class="tab-bar">
      <div class="tab active">
        <i class="fas fa-home"></i>
        <span>welcome.md</span>
      </div>
    </div>
    
    <div class="content-area">
      <div class="posts-container">
        <%_ page.posts.each(function(post){ _%>
          <%
            // 获取文章缩略图：优先 front-matter 的 cover/thumbnail，其次文章内第一张图片
            var postThumbnail = null;
            if (post.cover) {
              postThumbnail = post.cover;
            } else if (post.thumbnail) {
              postThumbnail = post.thumbnail;
            } else {
              var imgMatch = post.content.match(/<img[^>]+src=["']([^"']+)["']/);
              if (imgMatch) {
                postThumbnail = imgMatch[1];
              }
            }
          %>
          <div class="post-card<%= postThumbnail ? ' has-thumbnail' : '' %>">
            <div class="post-card-content">
              <div class="post-card-top">
                <div class="post-card-info">
                  <div class="post-header">
                    <i class="fas fa-file-alt"></i>
                    <span class="post-title">
                      <a href="<%- url_for(post.path) %>"><%- post.title %></a>
                      <% if (post.sticky || post.top) { %>
                        <span class="sticky-indicator" title="<%= __('pinned_post') || 'Pinned Post' %>">
                          <i class="fas fa-thumbtack"></i>
                        </span>
                      <% } %>
                    </span>
                  </div>
                  
                  <div class="post-meta">
                    <span class="date">
                      <i class="fas fa-calendar-alt"></i>
                      <%- date(post.date, config.date_format) %>
                    </span>
                    <%_ if(post.categories && post.categories.length){ _%>
                      <span class="category">
                        <i class="fas fa-folder"></i>
                        <%- list_categories(post.categories, {
                          show_count: false,
                          style: 'none',
                          separator: ' '
                        }) %>
                      </span>
                    <%_ } _%>
                  </div>
                </div>
                <% if (postThumbnail) { %>
                  <div class="post-thumbnail">
                    <a href="<%- url_for(post.path) %>">
                      <img src="<%- postThumbnail %>" alt="<%- post.title %>" loading="lazy">
                    </a>
                  </div>
                <% } %>
              </div>
              
              <div class="post-excerpt">
                <%- post.excerpt || strip_html(post.content).substr(0, 200) %>...
              </div>
              
              <div class="post-footer">
                <a href="<%- url_for(post.path) %>" class="read-more">
                  <i class="fas fa-code"></i>
                  Read More
                </a>
              </div>
            </div>
          </div>
        <%_ }); _%>
      </div>
      
      <%- partial('_partial/pagination') %>
    </div>
  </div>
</div>
